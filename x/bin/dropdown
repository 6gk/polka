#!/bin/sh

[ -f /tmp/tabbed-status ] || touch /tmp/tabbed-status

if [ "$(cat /tmp/tabbed-status)" = windowunmap ]; then
	thing="windowmap" &&
	echo "windowmap" > /tmp/tabbed-status
else
	thing="windowunmap" &&
	echo "windowunmap" > /tmp/tabbed-status
fi

eval "$(xdotool search --classname "dropdown" getwindowgeometry --shell)"

# check which display has the window
# (I can't use pfd because that outputs my left monitor when
#  a window is maximized on my right monitor)
for i in $(lsd); do
	sw="$(dattr w "$i")"
	sh="$(dattr h "$i")"
	sx="$(dattr x "$i")"
	sy="$(dattr y "$i")"

	[ "$X" -ge "$sx" ] &&
		[ "$Y" -ge "$sy" ] &&
		[ "$X" -le $(( sw + sx )) ] &&
		[ "$Y" -le $(( sh + sy )) ] &&
		break
done

nx="$((sx + sw - $((sw / 2)) - $((WIDTH / 2))))"
ny="$((sy + sh - $((sh / 2)) - $((HEIGHT / 2 ))))"

xdotool search --classname "dropdown" $thing
xdotool search --classname "dropdown" windowmove "$nx" "$ny"
