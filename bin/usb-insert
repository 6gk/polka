#!/bin/zsh

if [[ -n $ID_INPUT_KEY  ]]; then
    type="Keyboard"
fi

if [[ -n $ID_INPUT_MOUSE  ]]; then
    type="Mouse"
fi

if [[ $ID_TYPE == disk ]]; then
    dev="$(echo $DEVNAME)"
    type="Disk"
fi

product=$(echo -e $ID_MODEL_ENC) 

brand="$(echo -e $ID_VENDOR_ENC)"

function notify-root() {
    #Detect the name of the display in use
    display=":$(/usr/bin/ls /tmp/.X11-unix/* | sed 's#/tmp/.X11-unix/X##' | head -n 1)"

    #Detect the user using such display
    user=$(who | grep '('$display')' | awk '{print $1}' | sed -n -e 1p)

    #Detect the id of the user
    uid=$(id -u $user)

    sudo -u $user DISPLAY=$display DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$uid/bus /usr/bin/notify-send "$@"
}

notify-root "New device detected" \
"Type: $type
Product: $product
Brand: $brand"
