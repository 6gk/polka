#!/bin/sh
n="$HOME/opt/x/pics/$(date +%F_%H-%M-%S).png"
mkdir -p "${n%/*}"

ff() {
	ffmpeg -y -loglevel error -f x11grab $3 \
		-video_size "${1%%+*}" -i ":0.0+${1#*+}" -vframes 1 "$2"
}

case $1 in
	# freeze & screenshot selection
	# don't worry, you're not meant to be able to read this :^)
	-s)
		mw="$(wattr wh "$(lsw -r)" | tr \  x)"
		ff "$mw+0,0" /tmp/scr.png
		feh -g "${mw%?}2+0+-1" --class feh-nb /tmp/scr.png &
		pid=$!

		w="$(sel '${W}x$H+$X,$Y')" &&
		n="${n%%.*}-${w%%+*}.png" &&
		ff "$w" "$n"; kill $pid
	;;
	# screenshot current monitor
	*)
		ff "$(mattr -g "$(pfm)")" "$n" '-draw_mouse 0'
	;;
esac

# copy image
xclip -sel clipboard -t image/png "$n"
