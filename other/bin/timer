#!/bin/sh
#
#  Source:
#     github.com/GaugeK/dots
#

sound="/usr/share/sounds/freedesktop/stereo/complete.oga"

calc() {
	seconds="$(echo "${1}*$2" | bc | sed 's/\..*$//')"
}

case "$1" in
	*h) calc "${1%?}" 3600;;
	*m) calc "${1%?}"   60;;
	*s) seconds="${1%?}"  ;;
	*)  calc "$1"       60;;
esac

{
	while [ "$seconds" -gt 0 ]; do
		{
			secl="$(date -d"0+$seconds sec" +%H:%M:%S)"
			printf "\r  %s" "$secl"
			echo "$secl" > "/tmp/timer-$$"
		} &
		seconds="$(( seconds - 1 ))"
		sleep 1
	done
	printf "\r%s\n" "Timer Finished"
	rm "/tmp/timer-$$"

	paplay "$sound" 2>/dev/null &
	notify-send -u critical "Timer finished" "$2"
} &
