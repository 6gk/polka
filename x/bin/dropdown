#!/bin/sh

[ -f /tmp/tabbed-status ] || touch /tmp/tabbed-status

if [ "$(cat /tmp/tabbed-status)" = windowunmap ]; then
	thing="windowmap" &&
	echo "windowmap" > /tmp/tabbed-status
else
	thing="windowunmap" &&
	echo "windowunmap" > /tmp/tabbed-status
fi

eval "$(xdotool getwindowfocus getwindowgeometry --shell)"

# check which display has the window
# (I can't use pfd because that outputs my left monitor when
#  a window is maximized on my right monitor)
for i in $(lsd); do
	set -- $(dattr whxy "$i")

	[ "$X" -ge "$3" ] &&
		[ "$Y" -ge "$4" ] &&
		[ "$X" -lt $(( $1 + $3 )) ] &&
		[ "$Y" -lt $(( $2 + $4 )) ] &&
		break
done

[ "$WIDTH" = 3360 ] &&
	set -- $(dattr whxy $(ppd))

eval "$(xdotool search --classname "dropdown" getwindowgeometry --shell)"

nx="$(($3 + $1 - $(($1 / 2)) - $((WIDTH / 2))))"
ny="$(($4 + $2 - $(($2 / 2)) - $((HEIGHT / 2 ))))"

xdotool search --classname "dropdown" $thing
xdotool search --classname "dropdown" windowmove "$nx" "$ny"
