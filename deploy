#!/usr/bin/env bash

[ "$1" = -y ] &&
	y=y

[[ ! "$y" ]] && {
	echo
	echo "This is made for me, and me alone, please do not"
	echo "expect this to work on your system, and do not complain"
	echo "that this doesn't work on your system."
	echo "I am not responsible for your system breaking"
	echo "if you proceed any further."
	echo

	printf '[Make sure this repository is installed as ~/opt/dots, then hit y] '
	read -r y
}
[[ $y = y ]] || exit

mkdir -p      \
	~/bin/app   \
	~/bin/bin   \
	~/etc       \
	~/usr/cache \
	~/opt 2>/dev/null

for i in $(echo $HOME/opt/dots/*/bin | sed -e "s|$HOME/opt/dots/||g" -e "s|/bin||g"); do
	cd $HOME/opt/dots/$i/bin || { echo "couldn't cd; exiting" && exit; }
	mkdir -p "$HOME/bin/$i"
	for j in $(find . -type d | sed 's|\./||g'); do
		mkdir -p $HOME/bin/$i/$j
		ln -sf $(find $PWD/$j/ -maxdepth 1 -type f | sed 's|\./||g') $HOME/bin/$i/$j/
	done
done

cp     $HOME/opt/dots/other/bin/app/* ~/bin/app
rm -rf $HOME/bin/other/app
ln -sf $HOME/opt/dots/*/etc/* ~/etc/ 2>/dev/null
ln -sf $HOME/opt/dots/*/usr/* ~/usr/ 2>/dev/null
cp -r  $HOME/opt/dots/other/usr/fonts/* ~/usr/fonts
#cp -r  $HOME/opt/dots/firefox/etc/.mozilla ~/etc/
