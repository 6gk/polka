#!/bin/sh
#
##
##   Shitty sCreenshot scRipt
##
#
# deps:
#  - crud     selecting area
#  - shotgun  screenshotting
#  - feh      freezing screen
#  - wmutils  getting combined screen size
#  - mmutils  getting dimensions of focused monitor
#  - xclip    copying image
#

n="$HOME/opt/x/pics/$(date +%F_%H-%M-%S).png"
mkdir -p "${n%/*}"

case $1 in
	-s)
		# get combined size of all screens (ex output: 3360x1080)
		mw="$(wattr wh "$(lsw -r)" | tr ' ' x)"
		# screenshot fullscreen
		shotgun -g "$mw" /tmp/scr.png
		# open that screenshot in feh to simulate a freeze
		feh -g "${mw%?}2+0+-1" --class feh-nb /tmp/scr.png &
		pid=$!

		w="$(sel)" &&
		n="${n%%.*}-${w%%+*}.png" &&
		shotgun -g "$w" "$n"
		kill $pid
	;;
	-f)
		shotgun -i "$(pfw)" "$n"
	;;
	# screenshot current monitor
	*)
		shotgun -g "$(mattr -g "$(pfm)")" "$n"
	;;
esac

# copy image
xclip -sel clipboard -t image/png "$n"
