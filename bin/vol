#!/bin/bash

function notify() {
    gdbus call -e -d "org.freedesktop.Notifications" \
        -o /org/freedesktop/Notifications \
        -m org.freedesktop.Notifications.Notify "" \
        $1 "" "$2" "$3" "[]" "{}" 5000 >/dev/null
}

muted="$(amixer -D pulse get Master | grep -i "\[off\]\|\[on\]" | awk '{print $6}' | sed -e '1!d' -e 's/\[//' -e 's/\]//')"

if [[ $muted = on ]]; then
    mute="mute"
elif [[ $muted = off ]]; then
    mute="unmute"
fi

[[ -n $2 ]] && p="$2" || p="5"

case $1 in 
    up)     amixer -D pulse sset Master $p%+ >/dev/null;;
    down)   amixer -D pulse sset Master $p%- >/dev/null;;
    set)    amixer -D pulse sset Master $2%  >/dev/null;;
    mute)   amixer -D pulse sset Master $mute >/dev/null;;
    unmute) amixer -D pulse sset Master $mute >/dev/null;;
    pause)  playerctl pause 2>/dev/null;;
    play)   playerctl play 2>/dev/null;;
    pp)     playerctl play-pause 2>/dev/null;;
    next)   playerctl next 2>/dev/null;;
    prev)   playerctl previous 2>/dev/null;;
    stop)   playerctl stop 2>/dev/null;;
    previous) playerctl previous 2>/dev/null;;
esac



pc_amix="$(amixer -D pulse get Master | grep -i "\[off\]\|\[on\]" | sed -e '1!d' -e 's/\[//g' -e 's/\]//g')"
pc_vol="$(echo ${pc_amix}  | awk '{print $5}')"
pc_mute="$(echo ${pc_amix} | awk '{print $6}')"

if [ $pc_mute = off ]; then
    output="♪ Muted"
elif [ $pc_mute = on ]; then
    output="♪ ${pc_vol}"
fi

media="$(playerctl metadata xesam:title 2>/dev/null)"
artist="$(playerctl metadata xesam:artist 2>/dev/null)"

[[ -n $artist ]] && SpA="$artist - $media" || SpA="$media"

playing="$(playerctl status 2>/dev/null)"

if [[ $playing == "Paused" ]]; then
    song="⏸  $SpA"
    play="paused"
    output_pp="Media $play"
elif [[ $playing == "Playing" ]]; then
    song="▶  $SpA"
    play="resumed"
    output_pp="Media $play"
    output_next="Skipped to the next in playlist"
    output_prev="Jumped back in playlist"
elif [[ -z $playing  ]]; then
    song="No playing media"
    output_prev="No playing media" 
    output_next="No playing media"
    output_pp="No playing media"
fi


case $1 in 
    up)     printf "%s\n" "$output"; notify 69 "Volume increased to $(printf "%s" "$output" | sed 's/♪ //')";;
    down)   printf "%s\n" "$output"; notify 69 "Volume decreased to $(printf "%s" "$output" | sed 's/♪ //')";;
    set)    printf "%s\n" "$output"; notify 69 "Volume set to $(printf "%s" "$output" | sed 's/♪ //')";;
    mute)   printf "%s\n" "$output"; notify 69 "$(printf "Volume %s" "${mute}d" | sed 's/♪ //'; [[ $mute == unmute ]] && printf "\n%s" "$output" | sed 's/♪ //')";;
    unmute) printf "%s\n" "$output"; notify 69 "$(printf "Volume %s" "${mute}d" | sed 's/♪ //')";;
    pause)  printf "$song\n"; notify 420 "$output_pp" "$song";;
    play)   printf "$song\n"; notify 420 "$output_pp" "$song";;
    pp)     printf "$song\n"; notify 420 "$output_pp" "$song";;
    next)   printf "$song\n"; notify 420 "$output_next" "$song";;
    prev)   printf "$song\n"; notify 420 "$output_prev" "$song";;
    stop)   printf "Media stopped\n"; notify 420 "Media stopped";;
    previous) printf "$song\n"; notify 420  "$output_prev" "$song";;
    status) case $2 in 
                vol)  printf "%s\n" "$output";;
                song) printf "%s\n" "$song";;
                *) printf "%s  /  %s\n" "$song" "$output";;
            esac;;
esac
