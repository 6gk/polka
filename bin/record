#!/bin/sh
# Modified from:
#   http://github.com/mitchweaver/bin
#
# Records the desktop or a selected rectangle with ffmpeg.
#

#
# Source:
#   https://gitlab.com/gaugek/dots/
#

#
# Syntax: 
# $ record <Offset X> <Offset Y> <Width> <Height> <Frames Per Second>
#
# If there are no arguments after running the command, it asks you for what arguments you want to use.
# 

if [ $# -eq 0 ];then
  offsetX="$(echo -e "1440\n0" | dmenu -nf '#CCCCCC' -nb '#181A21' -sb '#6992c5' -sf '#181A21' -fn 'Iosevka term-16' -i -p "Offset for the X axis")"
  offsetY="$(echo -e "0" | dmenu -nf '#CCCCCC' -nb '#181A21' -sb '#6992c5' -sf '#181A21' -fn 'Iosevka term-16' -i -p "Offset for the X axis")"
  width="$(echo -e "1920\n1366\n1440" | dmenu -nf '#CCCCCC' -nb '#181A21' -sb '#6992c5' -sf '#181A21' -fn 'Iosevka term-16' -i -p "Width")"
  height="$(echo -e "1080\n768\n900" | dmenu -nf '#CCCCCC' -nb '#181A21' -sb '#6992c5' -sf '#181A21' -fn 'Iosevka term-16' -i -p "Height")"
  rate="$(echo -e "30\n60" | dmenu -nf '#CCCCCC' -nb '#181A21' -sb '#6992c5' -sf '#181A21' -fn 'Iosevka term-16' -i -p "Framerate")"
fi

if [[ $(echo -e "No\nYes" | dmenu -nf '#CCCCCC' -nb '#181A21' -sb '#6992c5' -sf '#181A21' -fn 'Iosevka term-16' -i -p "Are you ready to record?") = Yes ]]; then 
  
  notify-send -t 2000 "recording started"

  ffmpeg -y -f x11grab -draw_mouse 1 -s ${width}x${height} \
      -r ${rate} -i :0.0+${offsetX},${offsetY} -qscale 0 \
      "$HOME/Videos/recordings/$(date '+%Y-%m-%d.%H:%M:%S')".mp4 \
      > /dev/null 2>&1

fi