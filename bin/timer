#!/bin/zsh

counting () {
  for ((i=minutes*60;i>=0;i--)); do
    clear
    echo
    echo -ne "\r  $(date -d"0+$i sec" +%H:%M:%S)"
    echo -ne "  $task "
    sleep 1s
  done
  echo
}

ctimer () {
  minutes="$1"
  task="$2"
  alarm_tone="/usr/share/sounds/freedesktop/stereo/complete.oga"
  if [ $# -eq 1 ]; then
    counting
    paplay $alarm_tone 2>/dev/null &
    notify-send -u critical "Timer finished" \
      -i dialog-warning -t 8000
  elif [ $# -eq 2 ]; then
    counting
    paplay $alarm_tone 2>/dev/null &
    notify-send -u critical "Timer finished: $task" \
      -i dialog-warning -t 8000
  elif [ $# -gt 2 ]; then
    echo "Error:  Task has unescaped space"
  fi
}

ctimer $@
