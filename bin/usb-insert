#!/usr/bin/env bash

dar() {
	display=":$(/usr/bin/ls /tmp/.X11-unix/* | sed 's#/tmp/.X11-unix/X##' | head -n 1)"
	user=$(w | grep "tty$(grep -o "[0-9][0-9]*" <<< $TTY)" | awk '{print $1}' | sed -n -e 1p)
	uid=$(id -u $user)

	sudo -u $user DISPLAY=$display DBUS_SESSION_BUS_ADDRESS=unix:path=/run/user/$uid/bus "$@"
}

out="$(printf "Brand:"
printf "%40s" "$ID_VENDOR_ENCâ€‹\n"
printf "Product:"
printf "%36s" "$ID_MODEL_ENCâ€‹"
)"

dar /usr/bin/notify-send "New device detected" "$out"
dar /usr/bin/paplay /usr/local/sounds/usb-insert.wav
